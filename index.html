<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>BrokeBull â€” Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />

  <!-- Firebase Compat -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-functions-compat.js"></script>
  <script src="firebase.js"></script>
</head>

<body>
  <header class="hero">
    <img class="logo" src="images/logo.jpg" alt="BrokeBull" />
    <h1>Welcome to BrokeBull</h1>
    <div id="authActions" class="auth-links">
      <!-- Buttons filled by script -->
      <a class="btn btn-primary" href="basic.html" id="ctaBasic" style="display:none;">Go to Basic</a>
      <a class="btn" href="pro.html" id="ctaPro" style="display:none;">Go to Pro</a>
      <a class="btn" href="login.html" id="ctaLogin" style="display:none;">Log In</a>
      <button class="btn" id="ctaLogout" style="display:none;" onclick="logout()">Logout</button>
    </div>
  </header>

  <main class="container" style="max-width:1100px;margin:0 auto;padding:28px 20px;">
    <section class="card" style="margin-bottom:18px;">
      <h3>Basic Access</h3>
      <p>Market overview, news, calendar, and symbol snapshots.</p>
      <div style="display:flex; gap:10px; flex-wrap:wrap;">
        <a class="btn btn-primary" href="basic.html">Go to Basic</a>
        <a class="btn btn-outline" href="pro.html">See Pro Features</a>
      </div>
    </section>

    <section class="card">
      <h3>Pro Access</h3>
      <p>Advanced charts, screener, Stage-2 watchlist, and Founder Q&amp;A.</p>
      <div style="display:flex; gap:10px; flex-wrap:wrap;">
        <a class="btn btn-primary" href="pro.html">Go to Pro</a>
        <a class="btn" href="https://newsletter.brokebullinvestments.com/subscribe" target="_blank" rel="noopener">Subscribe to Newsletter</a>
      </div>
    </section>
  </main>

  <script>
    // Adapt CTAs based on auth + role
    (function init() {
      const auth = firebase.auth();
      const db   = firebase.firestore();

      const $ = id => document.getElementById(id);
      const show = el => el && (el.style.display = "");
      const hide = el => el && (el.style.display = "none");

      auth.onAuthStateChanged(async user => {
        if (!user) {
          // Signed out: show Login + both plan links
          show($("ctaLogin"));
          show($("ctaBasic"));
          show($("ctaPro"));
          hide($("ctaLogout"));
          return;
        }
        // Signed in: show Logout
        hide($("ctaLogin"));
        show($("ctaLogout"));

        try {
          const snap = await db.collection('users').doc(user.uid).get();
          const role = snap.exists && snap.data().role ? snap.data().role : 'basic';
          // Always show Basic
          show($("ctaBasic"));
          // Pro visible for everyone; non-pro clicking pro.html will get redirected to Basic with upgrade=1
          show($("ctaPro"));
          // Label tweak if you're pro
          if (role === 'pro') $("ctaPro").textContent = "Go to Pro";
          else $("ctaPro").textContent = "Upgrade to Pro";
        } catch (e) {
          console.warn('Role check failed; showing default CTAs', e);
          show($("ctaBasic")); show($("ctaPro"));
        }
      });
    })();
  </script>
</body>
</html>
