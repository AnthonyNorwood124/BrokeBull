<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>BrokeBull — Pro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />

  <!-- De-tint hammer (wins over style.css) -->
  <style id="detint">
    /* Nuke page-wide pseudo overlays on plan pages */
    body.plan-basic::before,
    body.plan-basic::after,
    body.plan-pro::before,
    body.plan-pro::after {
      display: none !important;
      content: '' !important;
      background: none !important;
      opacity: 0 !important;
      filter: none !important;
    }

    /* Make the hero fully opaque on Pro */
    body.plan-pro .hero {
      background: linear-gradient(140deg, #6c2eb8 0%, #2c0054 50%, #0f0f12 100%) !important;
    }

    /* Solidify any glass cards/panels so bg can't leak through */
    .card, .panel {
      background: #121216 !important;
      backdrop-filter: none !important;
      -webkit-backdrop-filter: none !important;
    }

    /* Neutralize any fixed full-screen dimmer/scrim/preview overlay */
    [class*="overlay"], [class*="scrim"], [class*="veil"],
    [id*="overlay"],   [id*="scrim"],   [id*="veil"], [id*="preview"] {
      mix-blend-mode: normal !important;
      background: transparent !important;
      filter: none !important;
      opacity: 1 !important;
      pointer-events: none !important;
    }
    [class*="overlay"]::before, [class*="overlay"]::after,
    [class*="scrim"]::before,   [class*="scrim"]::after,
    [class*="veil"]::before,    [class*="veil"]::after,
    [id*="overlay"]::before,    [id*="overlay"]::after,
    [id*="preview"]::before,    [id*="preview"]::after {
      content: none !important;
      background: transparent !important;
    }
  </style>

  <!-- Firebase Compat -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-functions-compat.js"></script>
  <script src="firebase.js"></script>
</head>

<body class="plan-pro">
  <header class="hero">
    <img class="logo" src="images/logo.jpg" alt="BrokeBull" />
    <h1>BrokeBull — Pro</h1>
    <div>
      <a class="btn" href="index.html">Home</a>
      <a class="btn" href="dashboard.html">Dashboard</a>
      <a class="btn" href="basic.html">Basic</a>
      <button class="btn" onclick="logout()">Logout</button>
    </div>
  </header>

  <div id="loading" style="color:#bbb;text-align:center;margin:24px 0;">Loading…</div>

  <main id="content" class="container" style="max-width:1100px;margin:0 auto;padding:20px;display:none;">

    <!-- Market Overview -->
    <section>
      <h2>Market Overview</h2>
      <div class="tradingview-widget-container" style="height:520px;">
        <div class="tradingview-widget-container__widget"></div>
        <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-market-overview.js" async>
        {
          "colorTheme": "dark",
          "dateRange": "12M",
          "showChart": true,
          "locale": "en",
          "width": "100%",
          "height": "500",
          "isTransparent": false,
          "tabs": [
            {
              "title": "US Stocks",
              "symbols": [
                {"s":"NASDAQ:AAPL"}, {"s":"NASDAQ:NVDA"}, {"s":"NASDAQ:TSLA"},
                {"s":"NASDAQ:MSFT"}, {"s":"NYSE:PLTR"}, {"s":"NYSE:SHOP"}
              ]
            }
          ]
        }
        </script>
      </div>
    </section>

    <!-- Market News -->
    <section>
      <h2>Market News</h2>
      <div class="tradingview-widget-container" style="height:520px;">
        <div class="tradingview-widget-container__widget"></div>
        <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-timeline.js" async>
        {
          "feedMode": "all_symbols",
          "isTransparent": false,
          "displayMode": "regular",
          "width": "100%",
          "height": "500",
          "colorTheme": "dark",
          "locale": "en"
        }
        </script>
      </div>
    </section>

    <!-- Economic Calendar -->
    <section>
      <h2>Economic Calendar</h2>
      <div class="tradingview-widget-container" style="height:520px;">
        <div class="tradingview-widget-container__widget"></div>
        <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-events.js" async>
        {
          "width": "100%",
          "height": "500",
          "locale": "en",
          "importanceFilter": "-1,0,1",
          "colorTheme": "dark",
          "isTransparent": false
        }
        </script>
      </div>
    </section>

    <!-- Pro: Advanced Real-Time Chart -->
    <section>
      <h2>Advanced Chart</h2>
      <div class="tradingview-widget-container" style="margin-bottom:16px;">
        <div class="tradingview-widget-container__widget"></div>
        <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js" async>
        {
          "autosize": true,
          "symbol": "NASDAQ:QQQ",
          "interval": "D",
          "timezone": "Etc/UTC",
          "theme": "dark",
          "style": "1",
          "locale": "en",
          "allow_symbol_change": true,
          "withdateranges": true,
          "hide_top_toolbar": false,
          "save_image": false,
          "studies": ["MASimple@tv-basicstudies","RSI@tv-basicstudies","MACD@tv-basicstudies"]
        }
        </script>
      </div>
    </section>

    <!-- Pro: Stock Screener -->
    <section>
      <h2>Stock Screener</h2>
      <div class="tradingview-widget-container" style="margin-bottom:16px;">
        <div class="tradingview-widget-container__widget"></div>
        <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-screener.js" async>
        {
          "width": "100%",
          "height": 600,
          "defaultColumn": "overview",
          "screener_type": "stock",
          "displayCurrency": "USD",
          "colorTheme": "dark",
          "locale": "en",
          "isTransparent": false
        }
        </script>
      </div>
    </section>

    <!-- Pro: Founder Q&A -->
    <section>
      <h2>Founder Q&A</h2>
      <p>Submit questions for Tony’s weekly Q&A.</p>
      <form action="https://formspree.io/f/xnnveoor" method="POST" class="qa-form">
        <input type="email" name="email" placeholder="Your email" required />
        <textarea name="question" placeholder="Ask your question…" rows="4" required></textarea>
        <button type="submit" class="btn">Submit Question</button>
      </form>
    </section>

    <!-- Pro: Stage 2 Algo Watchlist -->
    <section>
      <h2>Stage-2 Algo Watchlist</h2>
      <ul class="watchlist">
        <li><strong>TSLA</strong> — Breakout watch above recent base; volume expansion signal</li>
        <li><strong>SMCI</strong> — Pullback to 21EMA; look for reversal confirmation</li>
        <li><strong>NVDA</strong> — Flag forming; relative strength intact</li>
        <li><strong>PLTR</strong> — Retest of prior breakout area; risk-managed entries only</li>
      </ul>
      <p class="tiny">We can make this auto-populate from JSON in the repo. Low lift.</p>
    </section>
  </main>

  <script>
    // Require auth + role === 'pro'
    document.addEventListener('DOMContentLoaded', () => {
      const auth = firebase.auth();
      const db   = firebase.firestore();

      const loading = document.getElementById('loading');
      const content = document.getElementById('content');

      auth.onAuthStateChanged(async (user) => {
        if (!user) { window.location.replace('login.html'); return; }
        try {
          const snap = await db.collection('users').doc(user.uid).get();
          const role = snap.exists && snap.data().role ? snap.data().role : 'basic';
          if (role !== 'pro') { window.location.replace('basic.html?upgrade=1'); return; }
          if (loading) loading.style.display = 'none';
          if (content) content.style.display = 'block';
        } catch (err) {
          console.error(err);
          window.location.replace('basic.html');
        }
      });
    });

    // Rogue overlay sweeper (after load + a 2nd pass for late injectors)
    window.addEventListener('load', () => {
      const sweep = () => {
        const nearFull = (n) => {
          const r = n.getBoundingClientRect();
          return r.width >= innerWidth * 0.9 && r.height >= innerHeight * 0.9;
        };
        document.querySelectorAll('body *').forEach(n => {
          const s = getComputedStyle(n);
          const fixed = s.position === 'fixed';
          const bg = s.backgroundColor || '';
          const semi = (s.opacity && parseFloat(s.opacity) < 1) ||
                       (/rgba\(/.test(bg) && /, *0\.\d+\)/.test(bg));
          if (fixed && nearFull(n) && semi) {
            n.style.background = 'transparent';
            n.style.opacity = '1';
            n.style.filter = 'none';
            n.style.pointerEvents = 'none';
          }
        });
      };
      sweep();
      setTimeout(sweep, 400);
    });
  </script>
</body>
</html>
